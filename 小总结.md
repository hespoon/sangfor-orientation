## 方法步骤

1. 先写单元测试，再实现函数
2. 通过 lcov 检查单元测试的代码覆盖率，补充测试用例提高代码覆盖率。
3. API 全部完成并通过测试后，用 valgrind 做内存检查，修改内存泄露的地方。

## 学到的新知识

1. lcov 代码覆盖率检查工具
2. valgrind 内存检查工具
3. xtest 测试框架
4. 如何在 C 语言中实现数据封装
5. 要用 static 修饰文件内函数
6. stderr 是没有缓冲的，可以保证错误提示输出的实时性
7. 可以使用 assert 断言建立契约，将部分简单直观符合逻辑的参数检查工作交给调用者完成
8. makefile 真方便
9. 第一次实践测试驱动开发

## 问题

1. 编写测试用例有什么技巧吗？如做到一次编写多次使用？

## 学以致用

1. 用测试驱动的方式编写 API，可以减少 API 的 bug，有助于一次编码就实现完善正确的接口。
2. 使用 lcov 检查单元测试的代码覆盖率，有针对性的添加测试用例，提高代码覆盖率。
3. 用单元测试和 lcov 结合起来代替断点调试，做到多动脑少动手。
4. 使用 lcov 观察函数的内部执行过程，减少断点调试，printf 的使用。
5. API 要有事务的特性，要么执行成功，要么相当于没有执行。
6. 内存申请，文件读写要配对，有申请有释放，有打开有关闭。
7. 灵活使用堆内存。
8. API 编写完毕后，使用 valgrind 检查内存泄露。